# TCP三次握手四次挥手

切入这个问题之前我们可以先了解一些小知识:

> 建立网络连接,两台服务器为什么可以建立连接?凭什么?

- 为什么都说建立一个TCP连接、建立一个HTTP连接后,就可以服务器通信了?
- 为什么? 
  - 我完全无法理解
  - 你说建立就建立?
  - 你说可以通信就可以通信?
  - 你说他们之间建立了通道就可以传消息?

- 这个建立的通道是个啥玩意? 
- 为什么TCP三次握手四次挥手建立了通道就可以传输信息了?
- 这个消息是怎么传的? 这个通道又是个什么东西?

**我们要从一点点原理出发**

> 信息、数据在网络中怎么传输的?

- 这是科学的世界,一切都要有一点点可以说得通的东西
- 通过什么?
  - 电信号: 通过导线传输信号
  - 电磁波: 通过一种向空气传播的波传输信号
- 三次握手四次挥手需要知道这些的原理嘛? 
- 不需要,懂一点点皮毛就可以了
- `电信号`简单一点,一条导线,所以通信的**通道**就是这条导线,这下是不是好理解很多
  - 信息、数据在网络通过电信号,**用一根根导线传输数据**
  - 电信号每次都是一条线,这个世界不可能都是线啊!对吧,那不是乱套了,手机就没有线
- `电磁波`就来了,电磁波怎么传输信息,**向空气,这尼玛,看不到啊!**
  - 所以**这是波 !  波怎么传递?**  四面八方的传播,一定不是指定位置的,就是跟水波一样四面八方的传递
  - 所以有了基站,你在一个地方发出一个信号波,向四面八方的传播
  - 你这个波一定有距离,太远了,波就弱了
  - 所以在一定距离内,必须有一个可以接收你这个波的基站
  - 基站接受后,用相同的方式,发出一个相同的波,继续四面八方的传播,到另一个基站
  - 最后你的服务器收到的这个信号,也就是这个数据
  - 怎么收到的,可能是波,也可能是波变成了电信号,转换为数据给了你
- 这个过程很花里胡哨,但是最终的结果能到服务器就可以了

> TCP和UDP

- 如果你需要了解三次握手四次挥手,我相信你已经知道了`TCP和UDP`的区别
- 没错:
  - TCP安全
  - UDP不安全
- 这不是废话嘛!
- 所以三次握手四次挥手就是为了**保证TCP安全的**,不然TCP和UDP没有啥区别
- UDP是什么,就是一个随便释放的信号,电信号也好、电磁波也好
  - 没有什么特殊含义,指定一个信号,是谁接收就可以了
  - 不在乎你是不是真的能接受到,你这个波半路没有基站传递,消失了就消失了
- TCP是什么,也是一个信号,但是不随便
  - 指定一个信号,是谁接受,但是保证接收方必须能接收到
  - 所以这个信号,必须保证波传递的过程中,有基站100%保证我这个波能传递到指定位置

> TCP三次握手四次挥手

- 不会因为传播中没有基站导致实际上信号是传递不过去

## 三次握手

> 作用: 

- 发送方 -> 确定**发送方可以发送和接收 + 接收方可以发送和接收**
  - 强调: 发送方和接收方都可以发送和接收
- 接收方 -> 确定**发送方可以发送和接收 + 接收方可以发送和接收**
  - 强调: 发送方和接收方都可以发送和接收

**是不是感觉很啰嗦**

- 三次握手就是解决这个啰嗦的问题的

**来一张图,我们不讲里面的什么花里胡哨的东西,我们按照简单的讲**

![image-20220409161450869](E:\Typora\图片保存\image-20220409161450869.png)

- 再次强调目的: 2方都要同时满足4个条件
  - 客户端能确定`自己能发送`、`自己能接收`、`对方能发送`、`对方能接收` 
  - 服务器能确定`自己能接收`、`对方能发送`、`自己能发送` 、`对方能接收` 
- 你必须理解这个意思

> 第一次握手成功

- 客户端发出一条消息给服务器

**第一次握手完成得到了什么**

- 客户端只能确定`自己能发送` -> 4个条件还差3个
- 服务器能确定`自己能接收`、`对方能发送` -> 4个条件还差2个

> 第二次握手成功

- 服务器发出一条消息给客户端 -> 目的: 客户端我接收到了你的信息,服务器还发了信息回去给你

**两次握手得到了什么**

- 第一次
  - 客户端只能确定`自己能发送`
  - 服务器能确定`自己能接收`、`对方能发送`

- 第二次后
- 客户端能确定`自己能发送`、`自己能接收`、`对方能发送`、`对方能接收` -> 客户端完成所有验证
- 服务器能确定`自己能接收`、`对方能发送`、`自己能发送` -> 不能确定对方能接受

> 第三次握手成功

- 没有必要多说了吧! 懂的自然就懂了
- 服务器还差一次对方能接受 -> 也就是客户端能接收的信号
- 客户端发出一条消息给服务器 -> 服务器就确定了`客户端能接收的信号`

**完成所有握手**

目的:

- 客户端能确定`自己能发送`、`自己能接收`、`对方能发送`、`对方能接收` 
- 服务器能确定`自己能接收`、`对方能发送`、`自己能发送` 、`对方能接收` 

## 四次挥手

第一次和第二次是一组

第三次和第四次是一组

![image-20220409162554762](../../../图片保存\image-20220409162554762.png)

- 目的就是确定可以断开连接,没有数据要交换了
- 网络连接是包括请求和响应的
- 当确定`客户端不再发送接收数据`、`服务器也不再发送接收数据`,即可以断开
  - 客户端 -> `客户端不再发送数据、客户端不再接收数据、服务器不再发送数据、服务器不再接收数据`
  - 服务器 -> `服务器不再发送数据、服务器不再接收数据、客户端不再发送数据、客户端不再接收数据`
  - 注意: 不再发送数据了,不是说不再发送信号了

> 第一次挥手成功

- 客户端发出一条消息给服务器 -> 客户端不再发送数据

**第一次挥手完成得到了什么**

- 客户端 -> `客户端不再发送数据`  
- 服务器 ->  `客户端不再发送数据` 

> 第二次挥手

- 服务器发出一条消息给客户端  -> 既然客户端不再发送数据了,服务器也不再接收数据

**第二次挥手完成得到了什么**

- 客户端 -> `客户端不再发送数据、服务器不再接收数据`  
- 服务器 ->  `客户端不再发送数据、服务器不再接收数据` 

**前2次挥手结论:**

- 确定**客户端不再发送、服务器不再接收**

**后2次挥手预测:**

- 确定**服务器不再发送、客户端不再接收**

> 第三次挥手

- 服务器发出一条消息给客户端  -> 服务器不再发送数据
- 注意: 反过来了,看图
  - 前两次是客户端发起,服务器返回
  - 后两次是服务器发起,客户端返回

**第三次挥手完成后得到了什么**

- 客户端 -> `客户端不再发送数据、服务器不再接收数据`  + `服务器不再发送数据` 
- 服务器 -> `客户端不再发送数据、服务器不再接收数据` +  `服务器不再发送数据` 

> 第四次挥手

- 显而易见第四次挥手是为了确定**客户端不再接收数据**
- 客户端发出一条消息给服务器 -> 既然服务器不再发送数据了,那客户端不再接收数据

**后2次挥手结论:**

- 确定客户端不再接收、服务器也不会再发送

**最后完成目标**

- 客户端 -> `客户端不再发送数据、客户端不再接收数据、服务器不再发送数据、服务器不再接收数据`
- 服务器 -> `服务器不再发送数据、服务器不再接收数据、客户端不再发送数据、客户端不再接收数据`

- 断开连接